<div class="grid">
	<p-toast></p-toast>
	<div class="col-12">
		<div class="card">
			<form #form="ngForm" (ngSubmit)="insertData()">
				<p-dialog header="Add or Edit Stage" [(visible)]="display" [modal]="true" showEffect="fade"
					[style]="{width: '50vw'}" [breakpoints]="{'960px': '75vw'}">
					<div class="grid">
						<div class="col-12">
							<div class="card">
								<h5>Advanced</h5>
								<div class="p-fluid p-formgrid grid">
									<div class="field col-12 md:col-6">
										<label htmlFor="firstname2">Sujet </label>
										<input pInputText required minlength="4" id="sujet" #sujet="ngModel"
											name="sujet" [(ngModel)]="stage.sujet" type="text" />
										<div *ngIf="sujet.invalid && (sujet.dirty || sujet.touched)" class="alert">

											<div *ngIf="sujet.errors?.['required']">
												sujet is required.
											</div>
											<div *ngIf="sujet.errors?.['minlength']">
												sujet must be at least 4 characters long.
											</div>

										</div>

									</div>
									<!-- <div class="field col-12 md:col-6">
										<label htmlFor="lastname2">nom societe </label>
										<input pInputText id="lastname2" #societe="ngModel" required minlength="2"
											name="societe" [(ngModel)]="stage.societe" type="text" />
										<div *ngIf="societe.invalid && (societe.dirty || societe.touched)"
											class="alert">
											<div *ngIf="societe.errors?.['required']">
												societe is required.
											</div>
											<div *ngIf="societe.errors?.['minlength']">
												societe must be at least 2 characters long.
											</div>

										</div>
									</div> -->
									<div class="field col-12">
										<label htmlFor="lastname2">description </label>
										<input pInputText id="lastname2" #description="ngModel" required minlength="10"
											name="description" [(ngModel)]="stage.description" type="text" />
										
											<div *ngIf="description.invalid && (description.dirty || description.touched)"
											class="alert">
											<div *ngIf="description.errors?.['required']">
												description is required.
											</div>
											<div *ngIf="description.errors?.['minlength']">
												societe must be at least 10 characters long.
											</div>

										</div>
									</div>
									<div class="field col-12">
										<label htmlFor="domaine">domaine </label>
										<input pInputText id="domaine" required  #domaine="ngModel" name="domaine" [(ngModel)]="stage.domaine" minlength="4" type="text" />
										<div *ngIf="domaine.invalid && (domaine.dirty || domaine.touched)"
											class="alert">
											<div *ngIf="domaine.errors?.['required']">
												domaine is required.
											</div>
											<div *ngIf="domaine.errors?.['minlength']">
												domaine must be at least 4 characters long.
											</div>

										</div>
									</div>

									<div class="field col-12 md:col-6">
										<label htmlFor="firstname2">date debut </label>
										<p-calendar dateFormat="yy-mm-dd" [showIcon]="true" [required]="true" #datedebut="ngModel"
											name="datedebut" [minDate]="mindate" [maxDate]="stage.dateFin!"
											[(ngModel)]="stage.datedebut" inputId="icon"></p-calendar>
										<div *ngIf="datedebut.invalid && (datedebut.dirty || datedebut.touched)"
											class="alert">
											<div *ngIf="datedebut.errors?.['required']">
												datedebut is required.
											</div>


										</div>



									</div>
									<div class="field col-12 md:col-6">
										<label htmlFor="lastname2">date fin </label>

										<p-calendar dateFormat="yy-mm-dd" [showIcon]="true" #dateFin="ngModel" [required]="true"
											name="dateFin" [minDate]="stage.datedebut!" [(ngModel)]="stage.dateFin"
											inputId="icon"></p-calendar>
										<div *ngIf="dateFin.invalid && (dateFin.dirty || dateFin.touched)"
											class="alert">
											<div *ngIf="dateFin.errors?.['required']">
												dateFin is required.
											</div>
										</div>
									</div>
									<div *ngIf="stage._id!=undefined">
										<label htmlFor="available">available</label>
										<p-inputSwitch id="available" name="available" [(ngModel)]="stage.available"></p-inputSwitch>
									</div>



								</div>
							</div>
						</div>
					</div>

					<ng-template pTemplate="footer">

						<button pButton (click)="reset() " (click)="display=false" icon="pi pi-times" label="close"
							class="p-button-outlined"></button>
						<button [disabled]="form.invalid" pButton icon="pi pi-check" type="submit" label="Ok"
							class="p-button-outlined"></button>
					</ng-template>
				</p-dialog>
			</form>

<p-dialog header="Dialog" [(visible)]="displayup" [modal]="true" showEffect="fade"
[style]="{width: '50vw'}" [breakpoints]="{'960px': '75vw'}">
<!-- [customUpload]="true" (uploadHandler)="onUpload($event)" -->
<p-fileUpload name="file" url="/stage-server/file/upload/{{id}}" (onUpload)="onUpload($event)"
[multiple]="true" accept=".pdf" [maxFileSize]="1000000">
<ng-template pTemplate="content">
<ul *ngIf="uploadedFiles.length">
<li *ngFor="let file of uploadedFiles">{{file.name}} - {{file.size}} bytes</li>
</ul>
</ng-template>
</p-fileUpload>
<ng-template pTemplate="footer">

	<button pButton (click)="resetFile() " (click)="display=false" icon="pi pi-times" label="close"
		class="p-button-outlined"></button>
</ng-template>

</p-dialog>


<p-dialog header="Dialog" [(visible)]="displaydw" [modal]="true" showEffect="fade"
[style]="{width: '50vw'}" [breakpoints]="{'960px': '75vw'}">

<ng-template pTemplate="content">
<ul *ngIf="uploadedFiles.length">
<li *ngFor="let file of uploadedFiles">{{file.name}} - {{file.size}} bytes       <button (click)="download(file)"pButton pRipple type="button" icon="pi pi-download" onclick="" class="p-button-rounded p-button-text"></button>
				
</li>
</ul>
</ng-template>

<ng-template pTemplate="footer">

	<button pButton (click)="displaydw=false; this.uploadedFiles=[]" (click)="display=false" icon="pi pi-times" label="close"
		class="p-button-outlined"></button>
	
</ng-template>

</p-dialog>

















			<div class="grid">
				<div class="col-12 ">
					<h5>Les Stages</h5>
				</div>
				<div class="col-12">
					<div
						class="flex flex-row md:flex-column justify-content-between w-full md:w-auto align-items-center md:align-items-end mt-5 md:mt-0">
						<button type="submit" (click)="display=true" pButton icon="pi pi-plus" label="Add"></button>
					</div>

				</div>
			</div>


			<p-dataView #dv [value]="stages" [paginator]="true" [rows]="9" filterBy="domaine" [sortField]="sortField"
				[sortOrder]="sortOrder" layout="grid">
				<ng-template pTemplate="header">
					<div class="flex flex-column md:flex-row md:justify-content-between gap-2">
						
						<p-dropdown [options]="sortOptions" placeholder="Sort By validity"
							(onChange)="onSortChange($event)"></p-dropdown>

						<span class="p-input-icon-right">
							<i class="pi pi-search"></i>
							<input type="search" pInputText placeholder="Search by domaine"
								(input)="onFilter(dv, $event)">
						</span>
						<p-dataViewLayoutOptions></p-dataViewLayoutOptions>
					</div>
				</ng-template>

				<ng-template let-stage pTemplate="listItem">
					<div class="col-12">
						<div class="flex flex-column md:flex-row align-items-center p-3 w-full">
							<div class="flex-1 flex flex-column align-items-center text-center md:text-left">
								<div class="font-bold text-2xl">{{stage.sujet}}</div>
								<div class="mb-2">{{stage.description}}</div>
								<div class="flex align-items-center mt-2">
									<i class="pi pi-tag mr-2"></i>
									<span class="font-semibold">{{stage.domaine}}</span>
									
								</div>
							</div>
						
								<div
								class="flex flex-row md:flex-column justify-content-between w-full md:w-auto align-items-center md:align-items-end mt-5 md:mt-0">
								
								
								<span
									[class]="'' + stage.available=='true'?'product-badge  status-instock':'product-badge  status-outofstock'">{{stage.available==true?"
									available":" not available"}}</span>

									<p-splitButton label="action"  (onDropdownClick)="test(stage._id)"  [model]="items"   styleClass="p-button-success"></p-splitButton>
									<button pButton pRipple (click)="test(stage._id); displayup=true" type="button" label="postuler" class="p-button-text"></button>
			
							</div>

						</div>
					</div>
				</ng-template>
				
				<ng-template let-stage pTemplate="gridItem">
					<div class="col-12 md:col-4">
						<div class="card m-3 border-1 surface-border">
							<div class="flex flex-wrap gap-2 align-items-center justify-content-between mb-2">
								<div class="flex align-items-center">
									<i class="pi pi-tag mr-2"></i>
									<span class="font-semibold">{{stage.domaine}}</span>
								</div>
								
							
								<p-confirmDialog header="Confirmation" [key]="'confirmdelete'+stage._id" 
								[style]="{width: '350px'}" acceptButtonStyleClass="p-button-text" rejectButtonStyleClass="p-button-text"></p-confirmDialog>
			
								<span
									[class]="''+stage.available=='true'?'product-badge status-instock':'product-badge  status-outofstock'">{{stage.available==true?"
									available":" not available"}}</span>
							</div>
							<div class="flex flex-column align-items-center text-center mb-3">
								<div class="text-2xl font-bold">{{stage.sujet}}</div>
								<div class="mb-3">{{stage.description}}</div>
								<p-splitButton class="mb-3" label="action"  (onDropdownClick)="test(stage._id)"  [model]="items" styleClass="p-button-success"></p-splitButton>
								
								<button pButton pRipple (click)="test(stage._id); displayup=true" type="button" label="postuler" class="p-button-text"></button>
			
	
							</div>
							

						</div>
					</div>
				</ng-template>
			</p-dataView>
		</div>
	</div>